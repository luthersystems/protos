# Connectors Spec

This package includes the proto specification for the connector hub.

![Connectors Spec](./connectors.png)

Each participant on the Luther network run a connector hub, which optionally
runs in a cluster mode for HA.

By default, the connector hub runs in a stateless single-process "in-memory"
mode, without HA, and only partial durability.

Each third-party software system has a corresponding connector service which
registers with the respective connector hub.

The connector hub is responsible for listening to events raised by transactions
on the Luther network, relevant to the participant only. It then streams these
requests to connectors, and streams responses back to the platform. This flow
is the sink request/response flow.

# Sink Request/Response

Platform events contain requests that are destined for a specific connector.
The hub examines these requests and reliably delivers them to a registered
connector for that type, round-robin balancing across all connectors registered
for the same type.

Connector services are responsible for maintaining idempotency for a given
request ID, so that the hub can retry delivering requests and ensure at least
once delivery to the connector.

The connector must generate a response in a reasonable amount of time (seconds),
for a sink request. This is to ensure the request was successfully delivered
to the third-party system. The response is routed back to the platform.

Similarly, the platform is responsible for maintaining idempotency for
responses, which also use the request ID as the correlation ID for the request.

# Multiple Responses

The connector may return multiple responses (at a later time) to the original
request. This is indicated using the `response_number`, and is the mechanism
by which the platform can register to a stream of events from a third-party
system, similar to a webhook.

The connector is responsible for guaranteeing the delivery of the response to
the connector hub (at-least once delivery).
The connector hub ensures idempotency of the response processing.

# Source Request/Response

This mechanism is not implemented at the moment. It provides the flow of
information whereby a third-party system sends unsolicited requests to the
platform. For example, a UI that communicates with a REST/JSON gateway may
initiate requests for data stored in the platform, without a request first
generated by the platform.
